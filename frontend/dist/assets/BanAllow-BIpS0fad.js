import{r as v,w as R,c as T,f as o,l as g,k as a,g as e,i as m,K as O,F as x,p as V,t as u,h as B,v as S,C as w,O as k}from"./vendor-BDu8AGUg.js";import{_ as q,a as M}from"./index-ixAHyd21.js";const I={class:"modal-body"},K={class:"node-selection"},P=["disabled"],j=["value"],z={key:0,class:"loading"},G={key:1,class:"error-message"},H={key:2,class:"success-message"},J={key:3,class:"ban-allow-content"},Q={class:"form-section"},W={class:"form-row"},X={class:"form-group"},Y={class:"form-group"},Z={class:"form-row"},$={class:"form-group"},ee={class:"radio-group"},le={class:"radio-label"},te={class:"radio-label"},se={class:"form-group"},oe={class:"radio-group"},ae={class:"radio-label"},de={class:"radio-label"},ne={class:"form-actions"},ie=["disabled"],ue=["disabled"],re={class:"lists-section"},ve={class:"lists-container"},ce={class:"list-container"},me={class:"list-content"},pe={key:0,class:"list-table"},ye={key:1,class:"empty-list"},fe={class:"list-container"},be={class:"list-content"},ge={key:0,class:"list-table"},Ne={key:1,class:"empty-list"},we={__name:"BanAllow",props:{isVisible:{type:Boolean,default:!1},availableNodes:{type:Array,default:()=>[]},defaultNode:{type:String,default:""},displayedNodes:{type:Array,default:()=>[]}},emits:["update:isVisible"],setup(_,{emit:U}){const n=_,D=U,c=v(!1),b=v(!1),d=v(""),p=v(""),L=v("Loading..."),r=v(""),y=v({entries:[]}),f=v({entries:[]}),s=v({node:"",comment:"",listtype:"allowlist",deleteadd:"add"});R(()=>n.isVisible,i=>{if(i){C();let l=n.defaultNode;if(n.defaultNode&&n.defaultNode.includes(",")&&(l=n.defaultNode.split(",")[0].trim()),l&&n.displayedNodes.some(t=>t.id.toString()===l))r.value=l,N();else if(n.displayedNodes&&n.displayedNodes.length>0){const t=n.displayedNodes[0];r.value=t.id,N()}}});const A=T(()=>r.value&&n.displayedNodes.some(i=>i.id.toString()===r.value)),h=()=>{D("update:isVisible",!1),C()},C=()=>{c.value=!1,b.value=!1,d.value="",p.value="",y.value={entries:[]},f.value={entries:[]},s.value={node:"",comment:"",listtype:"allowlist",deleteadd:"add"}},N=async()=>{var i,l;if(A.value){c.value=!0,L.value="Loading access control lists...",d.value="",p.value="";try{const t=await M.post("/nodes/banallow",{localnode:r.value});t.data.success?(y.value=t.data.data.allowlist,f.value=t.data.data.denylist):d.value=t.data.message||"Failed to load access control lists"}catch(t){console.error("Ban/Allow error:",t),d.value=((l=(i=t.response)==null?void 0:i.data)==null?void 0:l.message)||"Failed to load access control lists"}finally{c.value=!1}}},F=async()=>{var i,l;if(!A.value){d.value="Please select a valid local node";return}b.value=!0,d.value="",p.value="";try{const t=await M.post("/nodes/banallow/action",{localnode:r.value,...s.value});t.data.success?(p.value=t.data.message,y.value=t.data.data.allowlist,f.value=t.data.data.denylist,s.value.node="",s.value.comment=""):d.value=t.data.message||"Failed to execute action"}catch(t){console.error("Ban/Allow action error:",t),d.value=((l=(i=t.response)==null?void 0:i.data)==null?void 0:l.message)||"Failed to execute action"}finally{b.value=!1}},E=()=>{N()};return(i,l)=>_.isVisible?(a(),o("div",{key:0,class:"modal-overlay",onClick:h},[e("div",{class:"modal-content",onClick:l[7]||(l[7]=B(()=>{},["stop"]))},[e("div",{class:"modal-header"},[l[8]||(l[8]=e("h3",null,"Node Access Control Lists",-1)),e("button",{class:"close-button",onClick:h},"Ã—")]),e("div",I,[e("div",K,[l[10]||(l[10]=e("label",{for:"localnode"},"Local Node:",-1)),m(e("select",{id:"localnode","onUpdate:modelValue":l[0]||(l[0]=t=>r.value=t),onChange:N,disabled:c.value},[l[9]||(l[9]=e("option",{value:""},"Select a node...",-1)),(a(!0),o(x,null,V(_.displayedNodes,t=>(a(),o("option",{key:t.id,value:t.id},u(t.id)+" => "+u(t.info||"Node not in database"),9,j))),128))],40,P),[[O,r.value]])]),c.value?(a(),o("div",z,[l[11]||(l[11]=e("div",{class:"spinner"},null,-1)),e("p",null,u(L.value),1)])):g("",!0),d.value?(a(),o("div",G,[e("p",null,u(d.value),1)])):g("",!0),p.value?(a(),o("div",H,[e("p",null,u(p.value),1)])):g("",!0),!c.value&&r.value&&!d.value?(a(),o("div",J,[e("div",Q,[l[20]||(l[20]=e("h4",null,"Add/Remove Node",-1)),e("form",{onSubmit:B(F,["prevent"]),class:"ban-allow-form"},[e("div",W,[e("div",X,[l[12]||(l[12]=e("label",{for:"node"},"Node Number:",-1)),m(e("input",{id:"node","onUpdate:modelValue":l[1]||(l[1]=t=>s.value.node=t),type:"text",maxlength:"7",pattern:"\\d+",required:"",placeholder:"Enter node number"},null,512),[[S,s.value.node]])]),e("div",Y,[l[13]||(l[13]=e("label",{for:"comment"},"Comment:",-1)),m(e("input",{id:"comment","onUpdate:modelValue":l[2]||(l[2]=t=>s.value.comment=t),type:"text",maxlength:"50",placeholder:"Optional comment"},null,512),[[S,s.value.comment]])])]),e("div",Z,[e("div",$,[l[16]||(l[16]=e("label",null,"List Type:",-1)),e("div",ee,[e("label",le,[m(e("input",{type:"radio","onUpdate:modelValue":l[3]||(l[3]=t=>s.value.listtype=t),value:"allowlist",checked:""},null,512),[[k,s.value.listtype]]),l[14]||(l[14]=w(" Allow List ",-1))]),e("label",te,[m(e("input",{type:"radio","onUpdate:modelValue":l[4]||(l[4]=t=>s.value.listtype=t),value:"denylist"},null,512),[[k,s.value.listtype]]),l[15]||(l[15]=w(" Deny List ",-1))])])]),e("div",se,[l[19]||(l[19]=e("label",null,"Action:",-1)),e("div",oe,[e("label",ae,[m(e("input",{type:"radio","onUpdate:modelValue":l[5]||(l[5]=t=>s.value.deleteadd=t),value:"add",checked:""},null,512),[[k,s.value.deleteadd]]),l[17]||(l[17]=w(" Add ",-1))]),e("label",de,[m(e("input",{type:"radio","onUpdate:modelValue":l[6]||(l[6]=t=>s.value.deleteadd=t),value:"delete"},null,512),[[k,s.value.deleteadd]]),l[18]||(l[18]=w(" Delete ",-1))])])])]),e("div",ne,[e("button",{type:"submit",class:"execute-button",disabled:b.value},u(b.value?"Executing...":"Execute"),9,ie),e("button",{type:"button",onClick:E,class:"refresh-button",disabled:c.value}," Refresh Lists ",8,ue)])],32)]),e("div",re,[e("div",ve,[e("div",ce,[l[23]||(l[23]=e("h4",null,"Allow List",-1)),e("div",me,[y.value.entries&&y.value.entries.length>0?(a(),o("div",pe,[e("table",null,[l[21]||(l[21]=e("thead",null,[e("tr",null,[e("th",null,"Node"),e("th",null,"Comment")])],-1)),e("tbody",null,[(a(!0),o(x,null,V(y.value.entries,t=>(a(),o("tr",{key:t.node},[e("td",null,u(t.node),1),e("td",null,u(t.comment),1)]))),128))])])])):(a(),o("div",ye,[...l[22]||(l[22]=[e("p",null,"No nodes in allow list",-1)])]))])]),e("div",fe,[l[26]||(l[26]=e("h4",null,"Deny List",-1)),e("div",be,[f.value.entries&&f.value.entries.length>0?(a(),o("div",ge,[e("table",null,[l[24]||(l[24]=e("thead",null,[e("tr",null,[e("th",null,"Node"),e("th",null,"Comment")])],-1)),e("tbody",null,[(a(!0),o(x,null,V(f.value.entries,t=>(a(),o("tr",{key:t.node},[e("td",null,u(t.node),1),e("td",null,u(t.comment),1)]))),128))])])])):(a(),o("div",Ne,[...l[25]||(l[25]=[e("p",null,"No nodes in deny list",-1)])]))])])])])])):g("",!0)])])])):g("",!0)}},xe=q(we,[["__scopeId","data-v-22d6eacd"]]);export{xe as default};
//# sourceMappingURL=BanAllow-BIpS0fad.js.map
