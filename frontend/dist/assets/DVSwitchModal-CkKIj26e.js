import{e as K,r as c,c as j,w as z,o as A,f as n,l as v,k as u,g as s,t as g,i as V,K as E,F as $,p as D,v as H,h as J}from"./vendor-BDu8AGUg.js";import{a as b,_ as P}from"./index-Cd0Rm2MK.js";const Q={class:"dvswitch-modal-content"},W={key:0,class:"loading-message"},X={key:1,class:"error-message"},Y={key:2,class:"dvswitch-section"},Z={class:"dvswitch-input-section"},ee=["disabled"],ae=["value"],se={key:0,class:"dvswitch-input-section"},te=["disabled"],le={value:""},oe=["value"],ne={key:1,class:"dvswitch-input-section"},ue=["disabled"],ie=["value"],de={key:0,class:"custom-tg-input"},re=["disabled"],ce={key:1,class:"tgif-note"},ve={class:"dvswitch-buttons"},ge=["disabled"],pe=["disabled"],me={key:2,class:"success-message"},he=K({__name:"DVSwitchModal",props:{isVisible:{type:Boolean},localNode:{}},emits:["update:isVisible"],setup(I,{emit:x}){const C=I,B=x,f=c([]),S=c([]),k=c([]),t=c(""),d=c(""),p=c(""),h=c(""),M=c(!1),_=c(!1),r=c(!1),l=c(null),w=c(null),y=j(()=>p.value==="__CUSTOM__"?h.value.trim():p.value),T=()=>{B("update:isVisible",!1),setTimeout(()=>{t.value="",d.value="",p.value="",h.value="",S.value=[],k.value=[],l.value=null,w.value=null},300)},F=async()=>{var o,a;M.value=!0,l.value=null;try{const e=await b.get("/dvswitch/nodes");if(e.data.success){if(f.value=e.data.data||[],f.value.length===0)l.value="No nodes with DVSwitch configured found.";else if(f.value.length===1)t.value=f.value[0].id,await N();else if(C.localNode){const m=f.value.find(i=>i.id===C.localNode);m&&(t.value=m.id,await N())}}else l.value=e.data.message||"Failed to load nodes"}catch(e){l.value=((a=(o=e.response)==null?void 0:o.data)==null?void 0:a.message)||"Error loading nodes. Make sure DVSwitch is configured.",console.error("Error loading DVSwitch nodes:",e)}finally{M.value=!1}},N=async()=>{d.value="",p.value="",h.value="",S.value=[],k.value=[],t.value&&await L()},L=async()=>{var o,a;if(t.value){_.value=!0,l.value=null;try{const e=await b.get(`/dvswitch/node/${encodeURIComponent(t.value)}/modes`);e.data.success?S.value=e.data.data||[]:l.value=e.data.message||"Failed to load modes"}catch(e){l.value=((a=(o=e.response)==null?void 0:o.data)==null?void 0:a.message)||"Error loading modes. Make sure DVSwitch is configured for this node.",console.error("Error loading DVSwitch modes:",e)}finally{_.value=!1}}},R=async()=>{var o,a;if(!d.value||!t.value){k.value=[],p.value="",h.value="";return}_.value=!0,l.value=null;try{const e=await b.get(`/dvswitch/node/${encodeURIComponent(t.value)}/mode/${encodeURIComponent(d.value)}/talkgroups`);e.data.success?k.value=e.data.data||[]:l.value=e.data.message||"Failed to load talkgroups"}catch(e){l.value=((a=(o=e.response)==null?void 0:o.data)==null?void 0:a.message)||"Error loading talkgroups",console.error("Error loading talkgroups:",e)}finally{_.value=!1}},O=()=>{p.value!=="__CUSTOM__"&&(h.value="")},G=async()=>{var o,a,e,m;if(!(!d.value||!t.value)){r.value=!0,l.value=null,w.value=null;try{const i=await b.post(`/dvswitch/node/${encodeURIComponent(t.value)}/mode/${encodeURIComponent(d.value)}`);i.data.success?(w.value=((o=i.data.data)==null?void 0:o.message)||`Switched node ${t.value} to mode: ${d.value}`,(a=i.data.data)!=null&&a.talkgroups?k.value=i.data.data.talkgroups:await R()):l.value=i.data.message||"Failed to switch mode"}catch(i){l.value=((m=(e=i.response)==null?void 0:e.data)==null?void 0:m.message)||"Error switching mode",console.error("Error switching mode:",i)}finally{r.value=!1}}},q=async()=>{var a,e,m;const o=y.value;if(!(!o||!t.value)){r.value=!0,l.value=null,w.value=null;try{const i=encodeURIComponent(o),U=await b.post(`/dvswitch/node/${encodeURIComponent(t.value)}/tune/${i}`,{node:t.value});U.data.success?w.value=((a=U.data.data)==null?void 0:a.message)||`Switched node ${t.value} to talkgroup: ${o}`:l.value=U.data.message||"Failed to switch talkgroup"}catch(i){l.value=((m=(e=i.response)==null?void 0:e.data)==null?void 0:m.message)||"Error switching talkgroup",console.error("Error switching talkgroup:",i)}finally{r.value=!1}}};return z(()=>C.isVisible,o=>{o&&F()}),A(()=>{C.isVisible&&F()}),(o,a)=>I.isVisible?(u(),n("div",{key:0,class:"dvswitch-modal-overlay",onClick:T},[s("div",{class:"dvswitch-modal",onClick:a[4]||(a[4]=J(()=>{},["stop"]))},[s("div",{class:"dvswitch-modal-header"},[a[5]||(a[5]=s("h2",null,"DVSwitch Mode Switcher",-1)),s("button",{class:"close-button",onClick:T},"×")]),s("div",Q,[M.value?(u(),n("div",W," Loading modes... ")):v("",!0),l.value?(u(),n("div",X,g(l.value),1)):v("",!0),!M.value&&!l.value?(u(),n("div",Y,[s("div",Z,[a[7]||(a[7]=s("label",{for:"dvswitch-node"},"Node:",-1)),V(s("select",{id:"dvswitch-node","onUpdate:modelValue":a[0]||(a[0]=e=>t.value=e),onChange:N,disabled:r.value},[a[6]||(a[6]=s("option",{value:""},"Select a node",-1)),(u(!0),n($,null,D(f.value,e=>(u(),n("option",{key:e.id,value:e.id}," Node "+g(e.id)+" "+g(e.system?`(${e.system})`:""),9,ae))),128))],40,ee),[[E,t.value]])]),t.value?(u(),n("div",se,[a[8]||(a[8]=s("label",{for:"dvswitch-mode"},"Mode:",-1)),V(s("select",{id:"dvswitch-mode","onUpdate:modelValue":a[1]||(a[1]=e=>d.value=e),onChange:R,disabled:r.value||_.value},[s("option",le,g(_.value?"Loading modes...":"Select a mode"),1),(u(!0),n($,null,D(S.value,e=>(u(),n("option",{key:e.name,value:e.name},g(e.name),9,oe))),128))],40,te),[[E,d.value]])])):v("",!0),d.value?(u(),n("div",ne,[a[12]||(a[12]=s("label",{for:"dvswitch-talkgroup"},"Talkgroup:",-1)),V(s("select",{id:"dvswitch-talkgroup","onUpdate:modelValue":a[2]||(a[2]=e=>p.value=e),onChange:O,disabled:r.value},[a[9]||(a[9]=s("option",{value:""},"Select a talkgroup",-1)),(u(!0),n($,null,D(k.value,e=>(u(),n("option",{key:e.tgid,value:e.tgid},g(e.alias)+" ("+g(e.tgid)+") ",9,ie))),128)),a[10]||(a[10]=s("option",{value:"__CUSTOM__"},"Custom TG",-1))],40,ue),[[E,p.value]]),p.value==="__CUSTOM__"?(u(),n("div",de,[V(s("input",{id:"custom-talkgroup","onUpdate:modelValue":a[3]||(a[3]=e=>h.value=e),type:"text",placeholder:"Enter custom talkgroup ID",disabled:r.value,class:"custom-tg-field"},null,8,re),[[H,h.value]])])):v("",!0),y.value&&y.value.includes("tgif.network")?(u(),n("div",ce,[...a[11]||(a[11]=[s("small",null,"ℹ️ Note: TGIF Network requires a key-up (transmission) after switching talkgroups for the change to take effect on the network.",-1)])])):v("",!0)])):v("",!0),s("div",ve,[s("button",{onClick:G,disabled:!t.value||!d.value||r.value,class:"action-button"},g(r.value?"Switching...":"Switch Mode"),9,ge),t.value&&d.value&&y.value?(u(),n("button",{key:0,onClick:q,disabled:!y.value||r.value,class:"action-button"},g(r.value?"Switching...":"Switch Talkgroup"),9,pe)):v("",!0),s("button",{onClick:T,class:"cancel-button"},"Cancel")]),w.value?(u(),n("div",me,g(w.value),1)):v("",!0)])):v("",!0)])])])):v("",!0)}}),ke=P(he,[["__scopeId","data-v-dc495a9a"]]);export{ke as default};
//# sourceMappingURL=DVSwitchModal-CkKIj26e.js.map
