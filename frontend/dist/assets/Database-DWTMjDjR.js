import{r as d,w as N,f as n,l as u,k as i,g as t,t as o,m as w,C as p,i as G,L,F as z,p as E,h as R}from"./vendor-BDu8AGUg.js";import{_ as O,a as S}from"./index-Cd0Rm2MK.js";const P={class:"modal-header"},U={class:"modal-body"},q={class:"astdb-generation-section"},I={key:0,class:"database-status"},K={class:"status-item"},H={key:0,class:"status-item"},$={key:1,class:"status-item"},j={key:2,class:"status-item"},J={key:3,class:"status-item"},Q={class:"status-item"},W={key:0},X={class:"status-item"},Y={class:"generation-controls"},Z={class:"checkbox-label"},ee=["disabled"],te={key:0,class:"loading"},se={key:1,class:"error-message"},ae={key:2,class:"database-display"},le={class:"database-header"},oe={class:"timestamp"},ne={key:0,class:"database-table-container"},ie={class:"database-table"},ue={class:"db-key"},re={class:"db-value"},de={key:1,class:"no-data-message"},ve={class:"raw-output-section"},ce={key:0,class:"raw-output"},pe={class:"raw-content"},be={__name:"Database",props:{isVisible:{type:Boolean,default:!1},localnode:{type:String,required:!0}},emits:["update:isVisible"],setup(k,{emit:F}){const g=k,M=F,b=d(!1),v=d(""),r=d(null),_=d(!1),l=d(null),m=d(!1),h=d(!1),c=d(""),f=d(!1);N(()=>g.isVisible,s=>{s?(C(),B()):x()});const D=()=>{M("update:isVisible",!1),x()},x=()=>{b.value=!1,v.value="",r.value=null,_.value=!1,l.value=null},C=async()=>{var s,e;if(b.value=!0,v.value="",r.value=null,!g.localnode||g.localnode.trim()===""){v.value="Local node number is required",b.value=!1;return}try{const a=await S.post("/nodes/database",{localnode:g.localnode.trim()});a.data.success?r.value=a.data.data:v.value=a.data.message||"Failed to retrieve database contents"}catch(a){console.error("Database error:",a),v.value=((e=(s=a.response)==null?void 0:s.data)==null?void 0:e.message)||"Failed to retrieve database contents"}finally{b.value=!1}},B=async()=>{try{const s=await S.get("/database/status",{timeout:3e4});s.data.success&&(l.value=s.data.data)}catch(s){console.error("Failed to load database status:",s)}},y=s=>s?new Date(s).toLocaleString():"",V=async()=>{var s,e;m.value=!0,c.value="",f.value=!1;try{const a=await S.post("/database/generate",{strictly_private:h.value});a.data.success?(f.value=!0,c.value=a.data.message||"ASTDB generated successfully!",B()):(f.value=!1,c.value=a.data.message||"Failed to generate ASTDB")}catch(a){console.error("ASTDB generation error:",a),f.value=!1,c.value=((e=(s=a.response)==null?void 0:s.data)==null?void 0:e.message)||"Failed to generate ASTDB"}finally{m.value=!1}},T=s=>{if(s==null)return"N/A";if(s===0)return"0 Bytes";const e=1024,a=["Bytes","KB","MB","GB","TB"],A=Math.floor(Math.log(s)/Math.log(e));return parseFloat((s/Math.pow(e,A)).toFixed(2))+" "+a[A]};return(s,e)=>k.isVisible?(i(),n("div",{key:0,class:"modal-overlay",onClick:D},[t("div",{class:"modal-content",onClick:e[2]||(e[2]=R(()=>{},["stop"]))},[t("div",P,[t("h3",null,"Database Contents - Node "+o(k.localnode),1),t("button",{class:"close-button",onClick:D},"Ã—")]),t("div",U,[t("div",q,[e[11]||(e[11]=t("h4",null,"Generate ASTDB",-1)),e[12]||(e[12]=t("p",null,"Generate or update the AllStar database (astdb.txt) file.",-1)),l.value?(i(),n("div",I,[t("div",K,[e[3]||(e[3]=t("strong",null,"File Status:",-1)),t("span",{class:w(l.value.file_exists?"status-ok":"status-error")},o(l.value.file_exists?"Exists":"Missing"),3)]),l.value.file_exists?(i(),n("div",H,[e[4]||(e[4]=t("strong",null,"File Size:",-1)),p(" "+o(T(l.value.file_size)),1)])):u("",!0),l.value.last_modified?(i(),n("div",$,[e[5]||(e[5]=t("strong",null,"Last Modified:",-1)),p(" "+o(y(l.value.last_modified*1e3)),1)])):u("",!0),l.value.last_generation?(i(),n("div",j,[e[6]||(e[6]=t("strong",null,"Last Generated:",-1)),p(" "+o(y(l.value.last_generation*1e3)),1)])):u("",!0),l.value.next_auto_update?(i(),n("div",J,[e[7]||(e[7]=t("strong",null,"Next Auto Update:",-1)),p(" "+o(y(l.value.next_auto_update*1e3)),1)])):u("",!0),t("div",Q,[e[8]||(e[8]=t("strong",null,"Auto Update:",-1)),t("span",{class:w(l.value.auto_update_enabled?"status-ok":"status-warning")},o(l.value.auto_update_enabled?"Enabled":"Disabled"),3),l.value.auto_update_enabled?(i(),n("span",W," (every "+o(l.value.auto_update_interval_hours)+" hours) ",1)):u("",!0)]),t("div",X,[e[9]||(e[9]=t("strong",null,"Private Nodes:",-1)),p(" "+o(l.value.private_nodes_count),1)])])):u("",!0),t("div",Y,[t("label",Z,[G(t("input",{type:"checkbox","onUpdate:modelValue":e[0]||(e[0]=a=>h.value=a)},null,512),[[L,h.value]]),e[10]||(e[10]=p(" Strictly Private (only local nodes) ",-1))]),t("button",{onClick:V,disabled:m.value,class:"generate-btn"},o(m.value?"Generating...":"Generate ASTDB"),9,ee)]),c.value?(i(),n("div",{key:1,class:w(["generation-message",f.value?"success":"error"])},o(c.value),3)):u("",!0)]),e[18]||(e[18]=t("hr",{class:"section-divider"},null,-1)),b.value?(i(),n("div",te,[...e[13]||(e[13]=[t("div",{class:"spinner"},null,-1),t("p",null,"Retrieving database contents...",-1)])])):u("",!0),v.value?(i(),n("div",se,[t("p",null,o(v.value),1)])):u("",!0),r.value?(i(),n("div",ae,[t("div",le,[e[14]||(e[14]=t("h4",null,"Database Entries",-1)),t("span",oe,o(y(r.value.timestamp)),1)]),r.value.entries&&r.value.entries.length>0?(i(),n("div",ne,[t("table",ie,[e[15]||(e[15]=t("thead",null,[t("tr",null,[t("th",null,"Key"),t("th",null,"Value")])],-1)),t("tbody",null,[(i(!0),n(z,null,E(r.value.entries,a=>(i(),n("tr",{key:a.key},[t("td",ue,o(a.key),1),t("td",re,o(a.value),1)]))),128))])])])):(i(),n("div",de,[...e[16]||(e[16]=[t("p",null,"No database entries found or database is empty.",-1)])])),t("div",ve,[t("button",{class:"toggle-raw-btn",onClick:e[1]||(e[1]=a=>_.value=!_.value)},o(_.value?"Hide":"Show")+" Raw Output ",1),_.value&&r.value.raw_output?(i(),n("div",ce,[e[17]||(e[17]=t("h5",null,"Raw AMI Output:",-1)),t("pre",pe,o(r.value.raw_output),1)])):u("",!0)])])):u("",!0)])])])):u("",!0)}},ge=O(be,[["__scopeId","data-v-ed518f2c"]]);export{ge as default};
//# sourceMappingURL=Database-DWTMjDjR.js.map
